---
import { getCollection, render } from "astro:content"
import Layout from "../../layouts/Layout.astro"
import { fade } from "astro:transitions"
import SectionLayout from "../../components/SectionLayout.astro"
import { Icon } from "astro-icon/components"
import ImageCarousel from "../../components/ImageCarousel.astro"

export async function getStaticPaths() {
  const projects = await getCollection("projects")

  return projects.map((project) => ({
    params: { id: project.slug },
    props: { project },
  }))
}

const { project } = Astro.props
const { data, slug } = project
const { name, cover, repository, live, fullstack, frontend, backend, images } =
  data

const { Content } = await render(project)
---

<Layout>
  <SectionLayout>
    <img
      src={`/images/${cover}`}
      alt={slug}
      class="absolute inset-0 w-full h-full object-fill z-0"
    />
    <div
      class="pointer-events-none absolute inset-0 z-10 bg-[#090b11]/60 backdrop-blur-xs"
      aria-hidden="true"
    >
    </div>
    <main
      class="relative z-50 w-full h-[100svh] flex justify-center items-center p-8"
    >
      <div
        class="flex flex-col gap-4 lg:flex-row p-6 h-[70svh] bg-zinc-900/80 backdrop-blur-3xl
        rounded-2xl border-2 border-white/10 shadow-2xl overflow-hidden"
      >
        <div class="max-w-lg">
          <h1
            transition:animate={fade({ duration: 200 })}
            transition:name={`name-${slug}`}
            class="text-[36px] md:text-[100px] font-bold"
            aria-label="Project Name"
          >
            {name}
          </h1>

          <div class="flex gap-4 pb-4" aria-label="Project Links">
            <a
              id={`${slug}-live-link`}
              aria-label="Visit live project"
              href={live}
              target="_blank"
              rel="noopener noreferrer"
              title="Live"
            >
              <Icon
                name="mdi:world-wide-web"
                class="text-2xl md:text-4xl text-gray-400 hover:text-lime-300 transition-colors duration-300 cursor-pointer"
              />
            </a>
            <a
              id={`${slug}-repository-link`}
              aria-label="Visit project repository"
              href={repository}
              target="_blank"
              rel="noopener noreferrer"
              title="Repository"
            >
              <Icon
                name="mdi:github"
                class="text-2xl md:text-4xl text-gray-400 hover:text-lime-300 transition-colors duration-300 cursor-pointer"
              />
            </a>
          </div>

          <div
            class="p-2 prose prose-invert text-balance rounded-2xl h-[48svh] overflow-y-auto"
            aria-label="Project Description"
          >
            <Content />
          </div>
        </div>

        <div class="flex flex-col gap-6">
          {
            images && images.length > 0 && (
              <ImageCarousel images={images} slug={slug} name={name} />
            )
          }

          <div>
            <h3
              class="text-2xl font-semibold text-center underline
                decoration-lime-300 decoration-2 underline-offset-6"
            >
              Tools
            </h3>
            {
              !fullstack ? (
                <div class="flex flex-col gap-2 max-w-2xl">
                  <h3 class="text-lg font-semibold">FrontEnd:</h3>
                  <ul
                    class="flex flex-wrap items-center gap-4 p-1"
                    aria-label="Frontend Technologies"
                  >
                    {frontend?.map((item) => {
                      return (
                        <li
                          class="flex items-center gap-1"
                          aria-label={`${item.name} Frontend Technology`}
                        >
                          <Icon name={item.icon} size={22} />
                          <span>{item.name}</span>
                        </li>
                      )
                    })}
                  </ul>
                </div>
              ) : (
                <div class="flex flex-col gap-4">
                  <div class="flex flex-col gap-2 max-w-2xl">
                    <h3 class="text-lg font-semibold">FrontEnd:</h3>
                    <ul
                      class="flex flex-wrap items-center gap-4 p-1"
                      aria-label="Frontend Technologies"
                    >
                      {frontend?.map((item) => {
                        return (
                          <li
                            class="flex items-center gap-1"
                            aria-label={`${item.name} Frontend Technology`}
                          >
                            <Icon name={item.icon} size={22} />
                            <span>{item.name}</span>
                          </li>
                        )
                      })}
                    </ul>
                  </div>

                  <div class="flex flex-col gap-2 max-w-2xl">
                    <h3 class="text-lg font-semibold">BackEnd:</h3>
                    <ul
                      class="flex flex-wrap items-center gap-4 p-1"
                      aria-label="Backend Technologies"
                    >
                      {backend?.map((item) => {
                        return (
                          <li
                            class="flex items-center gap-1"
                            aria-label={`${item.name} Backend Technology`}
                          >
                            <Icon name={item.icon} size={22} />
                            <span>{item.name}</span>
                          </li>
                        )
                      })}
                    </ul>
                  </div>
                </div>
              )
            }
          </div>
        </div>
      </div>
    </main>
  </SectionLayout>
</Layout>
